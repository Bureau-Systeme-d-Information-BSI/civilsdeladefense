%li.fr-sidemenu__item
  - data = {controller: 'fr-accordions-management', action: 'click->fr-accordions-management#collapse'}
  - options = {type: "button", aria: {controls: "fr-accordion-category", expanded: false}, data: data}
  %button.fr-sidemenu__btn{options}= t(".select")
  .fr-collapse{id: "fr-accordion-category"}
    %ul.fr-sidemenu__list
      - collection.each do |element|
        - children = element.children.where("published_job_offers_count > ?", 0)
        %div{data: { controller: 'subcheckbox'}}
          %li.fr-sidemenu__item
            .fr-container-fluid
              .fr-grid-row
                .fr-col-11
                  .fr-checkbox-group
                    %input{id: element.id, value: element.id, name: "job_offers[category_id][]", type: "checkbox", data: {action: "change->subcheckbox#propagate_downward", "subcheckbox-target": "upcheckbox"}}
                    %label{for: element.id}= element.name
                  - data = {controller: 'fr-accordions-management', action: 'click->fr-accordions-management#collapse'}
                  - options = {type: "button", aria: {controls: "fr-accordion-category-#{element.name}", expanded: false}, data: data}
                - if children.count > 0
                  .fr-col
                    %button.fr-sidemenu__btn.side{options}
          - if children.count > 0
            .fr-collapse.fr-sidemenu__list{id: "fr-accordion-category-#{element.name}"}
              = collection_check_boxes(:job_offers, :category_id, children, :id, :name, include_hidden: false) do |b|
                .fr-checkbox-group.fr-checkbox-group--sm
                  = b.check_box(checked: false, data: {action: "change->subcheckbox#propagate_upward", "subcheckbox-target": "downcheckbox"})
                  = b.label(class: "fr-label")
